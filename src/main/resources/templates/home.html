<!doctype html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title th:text="${title}">Home</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">LocalChat</a>
        <div class="navbar-nav">
            <a class="nav-link active" href="/">Home</a>
            <a class="nav-link" href="/chat">Chat</a>
            <a class="nav-link" href="/about">About</a>
        </div>
    </div>
</nav>

<main class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 text-center">

            <h1 class="mb-4">Добро пожаловать в LocalChat</h1>

            <p class="text-muted">
                Ваш IP: <strong id="ip" th:text="${ipAdress}"></strong>
            </p>

            <button class="btn btn-primary btn-lg" onclick="createUser()">
                Сгенерировать никнейм
            </button>

            <div class="alert alert-success mt-4 d-none" id="nicknameBox">
                Ваш никнейм: <strong id="nickname"></strong>
            </div>

            <a href="/chat" class="btn btn-outline-secondary mt-3">
                Перейти в чат
            </a>

        </div>
    </div>
</main>

<script>
    function createUser() {
        const ip = document.getElementById("ip").innerText;

        fetch("/api/users", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ipAdress: ip })
        })
        .then(res => res.json())
        .then(user => {
            localStorage.setItem("nickname", user.nickname);
            localStorage.setItem("ipAdress", ip);

            document.getElementById("nickname").innerText = user.nickname;
            document.getElementById("nicknameBox").classList.remove("d-none");
        });
    }

    // если ник уже есть
    const savedNick = localStorage.getItem("nickname");
    if (savedNick) {
        document.getElementById("nickname").innerText = savedNick;
        document.getElementById("nicknameBox").classList.remove("d-none");
    }
</script>

</body>
</html>
